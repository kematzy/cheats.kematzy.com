  <!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>:sinatra_helpers - Plugins - Roda - Web Framework - Ruby | Cheats by Kematzy</title>

    <link rel="stylesheet" href="/assets/css/styles.css">
    <!-- <link rel="stylesheet" href="../../../assets/css/-pygment_trac.css"> -->
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>


  <body>
    <div id="page" class="container">

      <nav id="header" class="navbar navbar-default">
  <div class="container-fluid row">

    <div class="navbar-header col-md-6">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="navbar-brand">
        <h1><a href="/">Cheats by Kematzy</a></h1>
        <p>A personal collection of Cheatsheets</p>
      </div>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse col-md-6" id="header-nav">
      <ul class="nav navbar-nav">
      
        
          
        <li class="">
          <a href="/index.html" title="back to the homepage">Home</a>
        </li>
        
        
          
        <li class="">
          <a href="/toc.html" title="full table of contents for this website">Table of Contents</a>
        </li>
        
        
          
        <li class="">
          <a href="/about.html" title="find out more information about this website">About</a>
        </li>
        
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>


      


<div id="breadcrumbs" class="row">
  <div class="col-md-12">
    <ol class="breadcrumb">
      <li><a href="/">Home</a></li>
      
        
        <li><a href="/ruby/">Ruby</a></li>
      
        
        <li><a href="/ruby/roda/">Roda</a></li>
      
        
        <li><a href="/ruby/roda/plugins/">Plugins</a></li>
      
        
        <li><a href="/ruby/roda/plugins/sinatra_helpers.html">Sinatra_helpers</a></li>
      
    </ol>
  </div>
</div>


      <div id="page-contents" class="row">

        <div class="col-md-12">
          <h1 id="ruby-roda-web-framework-plugins-sinatra_helpers">Ruby / Roda - Web Framework / Plugins / :sinatra_helpers</h1>

<hr>

<h2 id="introduction">Introduction</h2>

<p>The <strong>:sinatra_helpers</strong> plugin ports most of the helper methods defined in <code>Sinatra::Helpers</code> to <code>Roda</code>, 
other than those helpers that were already covered by other plugins such as caching and streaming.</p>

<p>Unlike Sinatra, the helper methods are added to either the request or response classes instead of 
directly to the scope of the route block.  </p>

<p>However, for consistency with Sinatra, delegate methods are added to the scope of the route block 
that call the methods on the <code>request</code> or <code>response</code>.  </p>

<p>If you do not want to pollute the namespace of the route block, you should load the plugin with the 
<code>delegate: false</code> option:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">plugin :sinatra_helpers, delegate: false</code></pre></div>

<h3 id="class-methods-added">Class Methods Added</h3>

<p>The only class method added by this plugin is <code>#.mime_type</code>, which is a shortcut for retrieving or 
setting MIME types in Rack&#39;s MIME database:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">Roda.mime_type &#39;csv&#39;                          # =&gt; &#39;text/csv&#39;
  Roda.mime_type &#39;foobar&#39;, &#39;application/foobar&#39; # set</code></pre></div>

<h3 id="request-methods-added">Request Methods Added</h3>

<p>In addition to adding the following methods, this changes <code>#.redirect</code> to use a <code>303</code> response status 
code by default for HTTP 1.1 non-GET requests, and to automatically use absolute URIs if the 
<code>:absolute_redirects</code> <code>Roda</code> class option is true, and to automatically prefix redirect paths with the
script name if the +:prefixed_redirects+ Roda class option is true.</p>

<p>When adding delegate methods, a logger method is added to the route block scope that calls the <code>logger</code> 
method on the request.</p>

<h3 id="back">back</h3>

<p><code>#.back</code> is an alias to referrer, so you can do:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">redirect back</code></pre></div>

<h3 id="error">error</h3>

<p><code>#.error</code> sets the response status code to <code>500</code> (or a status code you provide), and halts the request.  </p>

<p>It takes an optional body:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">error           # 500 response, empty boby

  error 501       # 501 reponse, empty body

  error &#39;b&#39;       # 500 response, &#39;b&#39; body

  error 501, &#39;b&#39;  # 501 response, &#39;b&#39; body</code></pre></div>

<h3 id="not_found">not_found</h3>

<p><code>#.not_found</code> sets the response status code to 404 and halts the request.</p>

<p>It takes an optional body:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">not_found      # 404 response, empty body

  not_found &#39;b&#39;  # 404 response, &#39;b&#39; body</code></pre></div>

<h3 id="uri">uri</h3>

<p><code>#.uri</code> by default returns absolute URIs that are prefixed by the script name:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">request.script_name # =&gt; &#39;/foo&#39;

  uri &#39;/bar&#39;          # =&gt; &#39;http://example.org/foo/bar&#39;</code></pre></div>

<p>You can turn of the absolute or script name prefixing if you want:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">uri &#39;/bar&#39;, false        # =&gt; &#39;/foo/bar&#39;

  uri &#39;/bar&#39;, true, false  # =&gt; &#39;http://example.org/bar&#39;

  uri &#39;/bar&#39;, false, false # =&gt; &#39;/bar&#39;</code></pre></div>

<p>This method is aliased as <code>#.url</code> and <code>#.to</code>.</p>

<h3 id="send_file">send_file</h3>

<p>This will serve the file with the given path from the file system:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">send_file &#39;path/to/file.txt&#39;</code></pre></div>

<h3 id="options">Options:</h3>

<table><thead>
<tr>
<th><strong>Option Name:</strong></th>
<th><strong>Description:</strong></th>
</tr>
</thead><tbody>
<tr>
<td>:disposition</td>
<td>Set the <code>Content-Disposition</code> to the given disposition.</td>
</tr>
<tr>
<td>:filename</td>
<td>Set the <code>Content-Disposition</code> to attachment (unless <code>:disposition</code> is set), and set the filename parameter to the value.</td>
</tr>
<tr>
<td>:last_modified</td>
<td>Explicitly set the <code>Last-Modified</code> header to the given value, and return a not modified response if there has not been modified since the previous request.  This option requires the <strong>:caching</strong> plugin.</td>
</tr>
<tr>
<td>:status</td>
<td>Override the <code>status</code> for the response.</td>
</tr>
<tr>
<td>:type</td>
<td>Set the <code>Content-Type</code> to use for this response.</td>
</tr>
</tbody></table>

<h2 id="response-methods-added">Response Methods Added</h2>

<h3 id="body">body</h3>

<p>When called with an argument or block, <code>#.body</code> sets the body, otherwise it returns the body:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">body      # =&gt; []
  
  body(&#39;b&#39;) # set body to &#39;b&#39;
  
  body{&#39;b&#39;} # set body to &#39;b&#39;, but don&#39;t call until body is needed</code></pre></div>

<h3 id="body">body=</h3>

<p><code>#.body</code> sets the body to the given value:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">response.body = &#39;v&#39;</code></pre></div>

<p>This method is not delegated to the scope of the route block, call <code>#.body</code> with an argument to set the value.</p>

<h3 id="status">status</h3>

<p>When called with an argument, <code>#.status</code> sets the status, otherwise it returns the status:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">status      # =&gt; 200

  status(301) # sets status to 301</code></pre></div>

<h3 id="headers">headers</h3>

<p>When called with an argument, <code>#.headers</code> merges the given headers into the current headers, otherwise 
it returns the headers:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">headers[&#39;Foo&#39;] = &#39;Bar&#39;
  
  headers &#39;Foo&#39; =&gt; &#39;Bar&#39;</code></pre></div>

<h3 id="mime_type">mime_type</h3>

<p><code>#.mime_type</code> just calls the Roda class method to get the <code>mime_type</code>.</p>

<h3 id="content_type">content_type</h3>

<p>When called with an argument, <code>#.content_type</code> sets the <code>Content-Type</code> based on the argument, 
otherwise it returns the <code>Content-Type</code>.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">mime_type             # =&gt; &#39;text/html&#39;
  
  mime_type &#39;csv&#39;       # set Content-Type to &#39;text/csv&#39;
  
  mime_type :csv        # set Content-Type to &#39;text/csv&#39;
  
  mime_type &#39;.csv&#39;      # set Content-Type to &#39;text/csv&#39;
  
  mime_type &#39;text/csv&#39;  # set Content-Type to &#39;text/csv&#39;</code></pre></div>

<h3 id="options">Options:</h3>

<table><thead>
<tr>
<th><strong>Option Name:</strong></th>
<th><strong>Description:</strong></th>
</tr>
</thead><tbody>
<tr>
<td>:charset</td>
<td>Set the <code>charset</code> for the mime type to the given <code>charset</code>, if the <code>charset</code> is not already set in the MIME type.</td>
</tr>
<tr>
<td>:default</td>
<td>Uses the given type if the mime type is not known.  If this option is not used and the MIME type is not known, an exception will be raised.</td>
</tr>
</tbody></table>

<h3 id="attachment">attachment</h3>

<p>When called with no filename, <code>#.attachment</code> just sets the <code>Content-Disposition</code> to <code>attachment</code>.  </p>

<p>When called with a filename, this sets the <code>Content-Disposition</code> to attachment with the appropriate 
filename parameter, and if the filename extension is recognised, this also sets the <code>Content-Type</code> 
to the appropriate MIME type if not already set.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">attachment          # set Content-Disposition to &#39;attachment&#39;

  attachment &#39;a.csv&#39;  # set Content-Disposition to &#39;attachment;filename=&quot;a.csv&quot;&#39;,
                      # also set Content-Type to &#39;text/csv&#39;</code></pre></div>

<h3 id="status-predicates">status predicates</h3>

<p>This adds the following predicate methods for checking the status:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">informational?  # 100-199

  success?        # 200-299

  redirect?       # 300-399

  client_error?   # 400-499

  not_found?      # 404

  server_error?   # 500-599</code></pre></div>

<p>If the status has not yet been set for the response, these will return <code>nil</code>.</p>

<h3 id="license">License</h3>

<p>The implementation was originally taken from <a href="http://sinatrarb.com/">Sinatra</a>, which is also released under the MIT License:</p>

<p>Copyright (c) 2007, 2008, 2009 Blake Mizerany
<br>
Copyright (c) 2010, 2011, 2012, 2013, 2014 Konstantin Haase</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and 
associated documentation files (the &quot;Software&quot;), to deal in the Software without restriction, including 
without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to 
the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in all copies or substantial 
portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT 
LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. 
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE 
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>

<hr>

<h3 id="requestmethods">RequestMethods</h3>

<h4 id="back"><code>#.back</code></h4>

<p>Alias for referrer</p>

<h4 id="error-code-500-body-nil"><code>#.error(code=500, body = nil)</code></h4>

<p>Halt processing and return the error status provided with the given code and  optional body.
If a single argument is given and it is not an integer, consider it the body and use a 500 status code.</p>

<h4 id="not_found-body-nil"><code>.not_found(body = nil)</code></h4>

<p>Halt processing and return a 404 response with an optional body.</p>

<h4 id="redirect-path-no_add_script_name-true-default_redirect_path-status-default_redirect_status"><code>#.redirect(path=(no_add_script_name = true; default_redirect_path), status=default_redirect_status)</code></h4>

<p>If the <code>absolute_redirects</code> or <code>:prefixed_redirects</code> roda class options has been set, respect those and update the path.</p>

<h4 id="send_file-path-opts-opts"><code>#.send_file(path, opts = OPTS)</code></h4>

<p>Use the contents of the file at +path+ as the response body.  See plugin documentation for options.</p>

<h4 id="uri-addr-nil-absolute-true-add_script_name-true-url-to"><code>#.uri(addr = nil, absolute = true, add_script_name = true)</code> <code>url</code>, <code>to</code></h4>

<p>Generates the absolute URI for a given path in the app. Takes Rack routers and reverse proxies into account.</p>

<hr>

<h3 id="responsemethods">ResponseMethods</h3>

<h4 id="status-value-return-status-nil"><code>#.status(value = (return @status; nil))</code></h4>

<p>Set or retrieve the response status code.</p>

<h4 id="body-value-return-body-unless-block_given-nil-amp-block"><code>#.body(value = (return @body unless block_given?; nil), &amp;block)</code></h4>

<p>Set or retrieve the response body. When a block is given, evaluation is deferred until the body is needed.</p>

<h4 id="body-body"><code>#.body=(body)</code></h4>

<p>Set the body to the given value.</p>

<h4 id="finish"><code>#.finish</code></h4>

<p>If the body is a DelayedBody, set the appropriate length for it.</p>

<h4 id="headers-hash-return-headers-nil"><code>#.headers(hash = (return @headers; nil))</code></h4>

<p>Set multiple response headers with Hash, or return the headers if no argument is given.</p>

<h4 id="mime_type-type"><code>#.mime_type(type)</code></h4>

<p>Look up a media type by file extension in Rack&#39;s mime registry.</p>

<h4 id="content_type-type-return-headers-content_type-nil-opts-opts"><code>#.content_type(type = (return @headers[CONTENT_TYPE]; nil), opts = OPTS)</code></h4>

<p>Set the Content-Type of the response body given a media type or file extension.  See plugin documentation for options.</p>

<h4 id="attachment-filename-nil-disposition-attachment"><code>#.attachment(filename = nil, disposition=ATTACHMENT)</code></h4>

<p>Set the <code>Content-Disposition</code> to <code>&quot;attachment&quot;</code> with the specified filename, instructing the user 
agents to prompt to save.</p>

<h4 id="informational"><code>#.informational?</code></h4>

<p>Whether or not the status is set to 1xx. Returns nil if status not yet set.</p>

<h4 id="success"><code>#.success?</code></h4>

<p>Whether or not the status is set to 2xx. Returns nil if status not yet set</p>

<h4 id="redirect"><code>#.redirect?</code></h4>

<p>Whether or not the status is set to 3xx. Returns nil if status not yet set.</p>

<h4 id="client_error"><code>#.client_error?</code></h4>

<p>Whether or not the status is set to 4xx. Returns nil if status not yet set.</p>

<h4 id="server_error"><code>#.server_error?</code></h4>

<p>Whether or not the status is set to 5xx. Returns nil if status not yet set.</p>

<h4 id="not_found"><code>#.not_found?</code></h4>

<p>Whether or not the status is set to 404. Returns nil if status not yet set.</p>

<hr>

<h3 id="classmethods">ClassMethods</h3>

<h4 id="mime_type-type-return-nil-value-nil"><code>#.mime_type(type=(return; nil), value = nil)</code></h4>

<p>If a type and value are given, set the value in Rack&#39;s <code>MIME</code> registry.</p>

<p>If only a type is given, lookup the type in Rack&#39;s <code>MIME</code> registry and return it.</p>

        </div>

      </div>

      <div id="footer" class="row">
  <div class="col-md-12">
    <p>Project maintained by <a href="https://github.com/kematzy">kematzy</a></p>
    <p>Hosted on GitHub Pages &mdash; Design based upon a theme created by <a href="https://github.com/orderedlist">orderedlist</a></p>
  </div>
</div>


    </div>

    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    <script src="../../../assets/js/jquery-2.1.3.min.js"></script>
    <script src="../../../assets/js/bootstrap.min.js"></script>
    <script src="../../../assets/js/highlight.pack.js"></script>
    <script src="../../../assets/js/toc.js"></script>
    <script src="../../../assets/js/anchor.min.js"></script>
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
      $(document).ready(function() {
        
        // style the tables a bit better
        $('table').addClass('table table-bordered table-hover');
        // create a TOC
        $('#toc').toc({ listType: 'ul',  headers: 'h2, h3', showEffect: 'slideDown' });
        // add anchors & permalinks
        anchors.add('h1, h2, h3, h4');
        
        // $('.clickable-header').click(function({
        //
        // }));
      });
    </script>
  </body>
</html>
