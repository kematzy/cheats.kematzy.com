  <!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>LetterPress - Gems - Ruby | Cheats by Kematzy</title>

    <link rel="stylesheet" href="../../assets/css/styles.css">
    <!-- <link rel="stylesheet" href="../../assets/css/-pygment_trac.css"> -->
    <script src="../../assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>


  <body>
    <div id="page" class="container">

      <nav id="header" class="navbar navbar-default">
  <div class="container-fluid row">

    <div class="navbar-header col-md-6">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="navbar-brand">
        <h1><a href="/">Cheats by Kematzy</a></h1>
        <p>A personal collection of Cheatsheets</p>
      </div>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse col-md-6" id="header-nav">
      <ul class="nav navbar-nav">
      
        
          
        <li class="">
          <a href="/index.html" title="back to the homepage">Home</a>
        </li>
        
        
          
        <li class="">
          <a href="/toc.html" title="full table of contents for this website">Table of Contents</a>
        </li>
        
        
          
        <li class="">
          <a href="/about.html" title="find out more information about this website">About</a>
        </li>
        
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>


      


<div id="breadcrumbs" class="row">
  <div class="col-md-12">
    <ol class="breadcrumb">
      <li><a href="/">Home</a></li>
      
        
        <li><a href="/ruby/">Ruby</a></li>
      
        
        <li><a href="/ruby/gems/">Gems</a></li>
      
        
        <li><a href="/ruby/gems/letterpress.html">Letterpress</a></li>
      
    </ol>
  </div>
</div>


      <div id="page-contents" class="row">

        <div class="col-md-12">
          <h1 id="ruby-gems-letterpress">Ruby / Gems / LetterPress</h1>

<hr>

<div id="toc"></div>

<hr>

<h2 id="introduction">Introduction</h2>

<p>Letterpress is a <em>lightweight</em> model generator that replaces fixture files.</p>

<h2 id="installation">Installation</h2>

<p>Add this line to your application&#39;s Gemfile:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">gem &#39;letterpress&#39;
</code></pre></div>
<p>And then execute:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ bundle
</code></pre></div>
<p>Or install it yourself as:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ gem install letterpress
</code></pre></div>
<h2 id="usage">Usage</h2>

<h3 id="rails-activerecord-and-minitest">Rails, ActiveRecord and minitest</h3>

<ol>
<li>Update Gemfile</li>
</ol>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">group :development, :test do
  gem &#39;letterpress&#39;, :require =&gt; &#39;letterpress/rails&#39;
end</code></pre></div>

<ol>
<li><p>Install the gem</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ bundle install
</code></pre></div></li>
<li><p>Update config/application.rb</p></li>
</ol>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">config.generators do |g|
  g.test_framework :mini_test, :spec =&gt; true, :fixture_replacement =&gt; :letterpress
end</code></pre></div>

<ol>
<li><p>Generate (test|spec)/blueprint.rb file</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ rails generate letterpress:install
</code></pre></div></li>
<li><p>Generate a model object with its factory</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ rails generate model Comment post_id:integer body:text
</code></pre></div></li>
<li><p>It adds to the end of file (test|spec)/blueprint.rb</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">class Comment &lt; Blueprint(ProxyMethods)
  default do
    post_id { 1 }
    body { &quot;MyText&quot; }
  end
end
</code></pre></div></li>
<li><p>Modify the generated blueprint according to your preferences</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">class Comment &lt; Blueprint(ProxyMethods)
  default do
    post { Post.make.new }
    body { &quot;MyText&quot; }
  end
end
</code></pre></div></li>
<li><p>Write tests in test/comment_test.rb</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">require &quot;minitest_helper&quot;

class CommentTest &lt; MiniTest::Rails::Model
  before do
    @comment = Comment.make.new
  end

  it &quot;must be valid&quot; do
    @comment.valid?.must_equal true
  end
end
</code></pre></div></li>
</ol>

<h2 id="rspec">Rspec</h2>

<p>Don&#39;t put the blueprint file in the support directory, if you do, the blueprint file will be required to early.
It should be placed directly in the spec folder: <code>spec/blueprint.rb</code>
If you do as describe below, the blueprint file is placed in the right place.</p>

<ol>
<li>Update config/application.rb</li>
</ol>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">config.generators do |g|
  g.test_framework :rspec, :fixture_replacement =&gt; :letterpress
end
</code></pre></div>
<ol>
<li>Generate spec/blueprint.rb file</li>
</ol>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">rails generate letterpress:install
</code></pre></div>
<h2 id="blueprint-class">Blueprint Class</h2>

<p>A blueprint for a model is defined inside the Letterpress module; the class name of the blueprint
<strong>must</strong> be the same as the models class name.</p>

<p>Below is an example of a Letterpress User class. Letterpress has two methods for
defining blueprints: <code>default</code> and <code>define</code>; <code>default</code> can be used once in each
class but <code>define</code> can be used as many time as you like. In this example
the <code>admin</code> attribute is overridden by the admin block. The admin block will inherit
the other attributes defined inside the default block.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">module Letterpress
  class User &lt; Blueprint(ProxyMethods)
    default do
      email { &quot;user@example.com&quot; }
      admin { false }
    end

    define(:admin) do
      admin { true }
    end
  end
end

user = User.make # =&gt; returns a proxy object (an instance of Letterpress::User)
user.admin # =&gt; false; itdelegates to an instance of the User class
user.email # =&gt; &quot;user@example.com&quot;

user = User.make(:admin)
user.admin # =&gt; true
user.email # =&gt; &quot;user@example.com&quot;

user = User.make(:admin, admin: false)
user.admin # =&gt; false
user.email # =&gt; &quot;user@example.com&quot;
</code></pre></div>
<h4 id="unique-attributes">Unique Attributes</h4>

<p>For attributes that must be unique, you can call the <code>sn</code> method within the
attribute block to get a unique serial number for the object.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">email { &quot;user-#{sn}@example.com&quot; } # Each email gets a unique serial number.

user1 = User.make
user2 = User.make

user1.email # =&gt; &quot;user1@example.com&quot;
user2.email # =&gt; &quot;user2@example.com&quot;
</code></pre></div>
<h4 id="associations">Associations</h4>

<p>When you create associations you don&#39;t have to persist them inside the blueprint.</p>

<ul>
<li>has_many</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"> # When defining a has_many association, you define it with an array.
 # These 2 comments will only be persisted in the database when Post.make.save
 # is called, and not when Post.make or Post.make.new is called.
comments { [ Comment.make.new, Comment.make.new ] }
</code></pre></div>
<ul>
<li>belongs_to</li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"> # Post.make.new defines a non persisted post instance.
 # The post instance will only be saved to the database if
 # Comment.make.save is called.
post { Post.make.new }
</code></pre></div>
<h4 id="what-you-must-know-to-create-a-blueprint-class">What you must know to create a blueprint class:</h4>

<ul>
<li>The class methods <code>default</code> and <code>define</code> is used for defining default attribute values.</li>
<li>An attribute values <strong>must</strong> be defined inside a block: <code>{}</code>.</li>
<li>The <code>sn</code> method is used inside an attribute block to create unique attribute values, e.g if
each user instance must have a unique email address.</li>
</ul>

<h2 id="creating-object">Creating Object</h2>

<p>Letterpress ads <a href="https://github.com/unders/letterpress/blob/master/lib/letterpress.rb#L12"><code>make</code></a> to each ActiveRecord class; When <code>make</code> is called on an ActiveRecord class, it returns a proxy object that will <a href="https://github.com/unders/letterpress/blob/master/lib/letterpress/blueprint.rb#L73">delegate</a>  its received messages to the ActiveRecord instance.</p>

<p>The <a href="https://github.com/unders/letterpress/blob/master/lib/letterpress.rb#L18">proxy object</a> implements these methods:</p>

<ul>
<li><p><a href="https://github.com/unders/letterpress/blob/master/spec/letterpress/rails_spec.rb#L86"><code>new</code></a> - returns the object under test or raises an exception if the object isn&#39;t valid.</p></li>
<li><p><a href="https://github.com/unders/letterpress/blob/master/spec/letterpress/rails_spec.rb#L108"><code>new!</code></a> - returns the object under test, even if not valid.</p></li>
<li><p><a href="https://github.com/unders/letterpress/blob/master/spec/letterpress/rails_spec.rb#L128"><code>save</code></a> - returns the persisted object under test or raises an exception if the object isn&#39;t valid.</p></li>
</ul>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">User.make # Returns instance of Letterpress::User
User.make(:admin) # Returns instance of Letterpress::User
User.make(:admin, email: &quot;foo@bar.com&quot;) # Returns instance of Letterpress::User


User.make.new # Returns a new User instance
User.make(:admin).save # Returns a persisted User instance
User.make(:admin, email: &quot;foo@bar.com&quot;).new! # Returns a new User instance
</code></pre></div>
<h2 id="creating-global-proxymethods">Creating global ProxyMethods</h2>

<p>Since each Letterpress class inherits from  <a href="https://github.com/unders/letterpress/blob/master/lib/letterpress.rb#L18">ProxyMethods</a>, we can define methods in that module and they will be added to each proxy object.</p>

<p>In the code snippet below I have added a <code>save_and_relod</code> method that will be available on every proxy object.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">module Letterpress
  module ProxyMethods
    def save_and_reload
      record = save
      @object = @object.class.find(record.id)
    end
  end
end

user = User.make.save_and_reload
</code></pre></div>
<h2 id="creating-proxymethods-on-a-class">Creating ProxyMethods on a class</h2>

<p>If you want to add a method to only one proxy object, see code below.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">module Letterpress
  class User &lt; Blueprint(ProxyMethods)
    default do
      #...
    end

    def password(password)
      @object.password = &quot;#{password} - in proxy&quot;
      @object
    end
  end
end

user = User.make.password(&quot;secret&quot;).save
user.password # =&gt; &quot;secret - in proxy&quot;
</code></pre></div>
<h2 id="overriding-make">Overriding .make</h2>

<p>If you for some reason want to do something with the proxy object before returning it, you can do that, see code below.</p>
<div class="highlight"><pre><code class="language-ruby" data-lang="ruby">module Letterpress
  class User &lt; Blueprint(ProxyMethods)
    default do
      #...
    end

    def self.make
     user = super
     # do something with the proxy object before returning it
     user.password =  &quot;I always have this value&quot;
     user
    end
  end
end

user = User.make.new
user.password # =&gt; &quot;I always have this value&quot;
</code></pre></div>
<h3 id="compatibility">Compatibility</h3>

<p>Ruby version 1.9.2 and 1.9.3 and Rails version 3.1</p>

<p><a href="http://test.rubygems.org/gems/letterpress">GemTesters</a> has more information on which platforms Letterpress is tested.</p>

<h2 id="test">Test</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">gem install rubygems-test
gem test letterpress
</code></pre></div>
<p>For more info see: <a href="http://test.rubygems.org/">GemTesters</a></p>

<h2 id="where">Where</h2>

<ul>
<li><a href="http://github.com/unders/letterpress">Letterpress @ Github</a></li>
<li><a href="http://test.rubygems.org/gems/letterpress">Letterpress @ GemTesters</a></li>
<li><a href="http://rubygems.org/gems/letterpress">Letterpress @ Rubygems</a></li>
<li><a href="http://rubydoc.info/gems/letterpress">Letterpress @ Rubydoc</a></li>
<li><a href="http://travis-ci.org/#!/unders/letterpress">Letterpress @ Travis</a></li>
</ul>

<h2 id="contributing">Contributing</h2>

<ol>
<li>Fork it</li>
<li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li>
<li>Commit your changes (<code>git commit -am &#39;Added some feature&#39;</code>)</li>
<li>Push to the branch (<code>git push origin my-new-feature</code>)</li>
<li>Create new Pull Request</li>
</ol>

        </div>

      </div>

      <div id="footer" class="row">
  <div class="col-md-12">
    <p>Project maintained by <a href="https://github.com/kematzy">kematzy</a></p>
    <p>Hosted on GitHub Pages &mdash; Design based upon a theme created by <a href="https://github.com/orderedlist">orderedlist</a></p>
  </div>
</div>

      
    </div>

    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    <script src="../../assets/js/jquery-2.1.3.min.js"></script>
    <script src="../../assets/js/bootstrap.min.js"></script>
    <script src="../../assets/js/highlight.pack.js"></script>
    <script src="../../assets/js/toc.js"></script>
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
      $(document).ready(function() {
        $('#toc').toc({ listType: 'ul',  headers: 'h2, h3', showEffect: 'slideDown' });
        // $('.clickable-header').click(function({
        //
        // }));
      });
    </script>
  </body>
</html>
